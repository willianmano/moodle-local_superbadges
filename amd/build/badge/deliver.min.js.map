{"version":3,"file":"deliver.min.js","sources":["../../src/badge/deliver.js"],"sourcesContent":["import $ from 'jquery';\nimport Swal from 'local_superbadges/sweetalert';\nimport showNotification from 'local_superbadges/notification';\nimport {get_strings as getMoodleStrings} from 'core/str';\nimport {deliverBadge} from './repository';\n\nlet strings = {\n    CONFIRM_TITLE: 'Are you sure?',\n    CONFIRM_MSG: 'Once delivered, the badge cannot be revoked!',\n    CONFIRM_YES: 'Yes, deliver it!',\n    CONFIRM_NO: 'Cancel'\n};\n\nconst COMPONENT_STRINGS = [\n    {\n        key: 'deliverbadge_confirm_title',\n        component: 'local_superbadges'\n    },\n    {\n        key: 'deliverbadge_confirm_msg',\n        component: 'local_superbadges'\n    },\n    {\n        key: 'deliverbadge_confirm_yes',\n        component: 'local_superbadges'\n    },\n    {\n        key: 'deliverbadge_confirm_no',\n        component: 'local_superbadges'\n    }\n];\n\nconst getStrings = async() => {\n    const trasnslatedStrings = await getMoodleStrings(COMPONENT_STRINGS);\n\n    strings.CONFIRM_TITLE = trasnslatedStrings[0];\n    strings.CONFIRM_MSG = trasnslatedStrings[1];\n    strings.CONFIRM_YES = trasnslatedStrings[2];\n    strings.CONFIRM_NO = trasnslatedStrings[3];\n    strings.SUCCESS = trasnslatedStrings[4];\n};\n\n/* eslint-disable */\nexport const init = (trigger) => {\n    getStrings();\n\n    $(\"body\").on(\"click\", trigger, function(event) {\n        event.preventDefault();\n\n        let eventTarget = $(event.currentTarget);\n\n        Swal.fire({\n            title: strings.CONFIRM_TITLE,\n            text: strings.CONFIRM_MSG,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: '#3085d6',\n            cancelButtonColor: '#d33',\n            confirmButtonText: strings.CONFIRM_YES,\n            cancelButtonText: strings.CONFIRM_NO\n        }).then(function (result) {\n            if (result.value) {\n                deliverTheBadge(eventTarget);\n            }\n        });\n    });\n};\n\nconst deliverTheBadge = async(eventTarget) => {\n    try {\n        toggleButton(eventTarget);\n\n        let response = await deliverBadge(eventTarget.data('id'));\n\n        toggleButton(eventTarget);\n\n        showNotification(response.message);\n\n        return true;\n    } catch (e) {\n        showNotification(e.message, 'error');\n\n        toggleButton(eventTarget);\n\n        return false;\n    }\n}\n\nconst toggleButton = (eventTarget) => {\n    let btn = $(eventTarget);\n    let icon = btn.find('i');\n\n    // Toggle enable/disable\n    btn.prop('disabled', (i, v) => !v);\n\n    let disableButton = btn.prop('disabled');\n\n    if (disableButton) {\n        icon.removeClass('fa-paper-plane-o');\n        icon.addClass('fa-spinner fa-spin');\n    } else {\n        icon.removeClass('fa-spinner fa-spin');\n        icon.addClass('fa-paper-plane-o');\n    }\n}\n"],"names":["strings","CONFIRM_TITLE","CONFIRM_MSG","CONFIRM_YES","CONFIRM_NO","COMPONENT_STRINGS","key","component","trigger","async","trasnslatedStrings","SUCCESS","getStrings","on","event","preventDefault","eventTarget","currentTarget","fire","title","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","then","result","value","deliverTheBadge","toggleButton","response","data","message","e","btn","find","prop","i","v","removeClass","addClass"],"mappings":"8gBAMIA,QAAU,CACVC,cAAe,gBACfC,YAAa,+CACbC,YAAa,mBACbC,WAAY,gBAGVC,kBAAoB,CACtB,CACIC,IAAK,6BACLC,UAAW,qBAEf,CACID,IAAK,2BACLC,UAAW,qBAEf,CACID,IAAK,2BACLC,UAAW,qBAEf,CACID,IAAK,0BACLC,UAAW,oCAeEC,UAXFC,iBACTC,yBAA2B,oBAAiBL,mBAElDL,QAAQC,cAAgBS,mBAAmB,GAC3CV,QAAQE,YAAcQ,mBAAmB,GACzCV,QAAQG,YAAcO,mBAAmB,GACzCV,QAAQI,WAAaM,mBAAmB,GACxCV,QAAQW,QAAUD,mBAAmB,IAKrCE,uBAEE,QAAQC,GAAG,QAASL,SAAS,SAASM,OACpCA,MAAMC,qBAEFC,aAAc,mBAAEF,MAAMG,mCAErBC,KAAK,CACNC,MAAOnB,QAAQC,cACfmB,KAAMpB,QAAQE,YACdmB,KAAM,UACNC,kBAAkB,EAClBC,mBAAoB,UACpBC,kBAAmB,OACnBC,kBAAmBzB,QAAQG,YAC3BuB,iBAAkB1B,QAAQI,aAC3BuB,MAAK,SAAUC,QACVA,OAAOC,OACPC,gBAAgBd,0BAM1Bc,gBAAkBrB,MAAAA,kBAEhBsB,aAAaf,iBAETgB,eAAiB,4BAAahB,YAAYiB,KAAK,cAEnDF,aAAaf,uCAEIgB,SAASE,UAEnB,EACT,MAAOC,mCACYA,EAAED,QAAS,SAE5BH,aAAaf,cAEN,IAITe,aAAgBf,kBACdoB,KAAM,mBAAEpB,aACRK,KAAOe,IAAIC,KAAK,KAGpBD,IAAIE,KAAK,YAAY,CAACC,EAAGC,KAAOA,IAEZJ,IAAIE,KAAK,aAGzBjB,KAAKoB,YAAY,oBACjBpB,KAAKqB,SAAS,wBAEdrB,KAAKoB,YAAY,sBACjBpB,KAAKqB,SAAS"}